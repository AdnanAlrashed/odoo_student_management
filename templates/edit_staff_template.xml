<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Edit Staff Simple Template -->
    <template id="edit_staff_simple_template" name="Edit Staff Simple">
        <html>
            <head>
                <title>Edit Staff</title>
                <meta name="viewport" content="width=device-width, initial-scale=1"/>
                <style>
                    body {
                        background: rgba(0,0,0,0.5);
                        margin: 0;
                        padding: 20px;
                        font-family: Arial, sans-serif;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        min-height: 100vh;
                    }
                    .popup {
                        background: white;
                        border-radius: 10px;
                        padding: 20px;
                        width: 100%;
                        max-width: 500px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    }
                    .form-group { margin: 15px 0; }
                    label { display: block; margin-bottom: 5px; font-weight: bold; }
                    input, textarea {
                        width: 100%;
                        padding: 8px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                    }
                    .buttons { margin-top: 20px; text-align: right; }
                    button {
                        padding: 10px 20px;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        margin-left: 10px;
                    }
                    .btn-primary { background: #007bff; color: white; }
                    .btn-secondary { background: #6c757d; color: white; }
                    .alert {
                        padding: 10px;
                        margin: 10px 0;
                        border-radius: 4px;
                    }
                    .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
                    .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
                    .loading { display: none; text-align: center; margin: 10px 0; }
                </style>
            </head>
            <body>
                <div class="popup">
                    <h2>Edit Staff Member</h2>

                    <t t-if="error">
                        <div class="alert alert-error">
                            <t t-out="error"/>
                        </div>
                    </t>

                    <t t-if="success">
                        <div class="alert alert-success">
                            <t t-out="success"/>
                        </div>
                    </t>

                    <form id="staffEditForm" method="post" t-attf-action="/student_management/admin/staff/edit/{{ staff.id }}">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                        <div class="form-group">
                            <label>Full Name:</label>
                            <input type="text" t-att-value="staff.name"/>
                        </div>

                        <div class="form-group">
                            <label>Email Address *:</label>
                            <input type="email" name="email" t-att-value="staff.user_id.email"/>
                        </div>

                        <div class="form-group">
                            <label>Address:</label>
                            <textarea name="address" rows="3"><t t-out="staff.address"/></textarea>
                        </div>

                        <div class="form-group">
                            <label>Phone:</label>
                            <input type="tel" name="phone" t-att-value="staff.user_id.phone"/>
                        </div>

                        <div class="loading" id="loading">
                            <div style="color: #007bff;">Saving changes...</div>
                        </div>

                        <div class="buttons">
                            <button type="button" class="btn-secondary" onclick="window.parent.closeEditModal()">Cancel</button>
                            <button type="submit" class="btn-primary" id="submitBtn">Update Staff</button>
                        </div>
                    </form>
                </div>

                <script>
                    document.addEventListener('DOMContentLoaded', function () {
                        const form = document.getElementById('staffEditForm');
                        if (!form) return;

                        form.addEventListener('submit', function (event) {
                            event.preventDefault();
                            const loading = document.getElementById('loading');
                            if (loading) loading.style.display = 'block';
                            const formData = new FormData(form);

                            const parts = window.location.pathname.split('/');
                            const staffId = parts[parts.length - 1] || parts[parts.length - 2];

                            fetch('/student_management/admin/staff/edit/' + staffId, {
                                method: 'POST',
                                body: formData,
                                headers: { 'X-Requested-With': 'XMLHttpRequest' }
                            })
                            .then(r =&gt; r.text())
                            .then(text =&gt; {
                                if (loading) loading.style.display = 'none';
                                if (text.trim() === 'OK') {
                                    if (window.parent) {
                                        window.parent.closeEditModal();
                                        window.parent.location.reload();
                                    } else {
                                        window.location.reload();
                                    }
                                } else {
                                    alert('Error: ' + text);
                                }
                            })
                            .catch(err =&gt; {
                                if (loading) loading.style.display = 'none';
                                console.error(err);
                                alert('Network error. Please try again.');
                            });
                        });
                    });
                </script>
            </body>
        </html>
    </template>
</odoo>